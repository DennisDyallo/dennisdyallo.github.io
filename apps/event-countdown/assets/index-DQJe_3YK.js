(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();class v{DEFAULT_HOLIDAY_CALENDAR="usa";constructor(e){this.holidayService=e,this.onUpdate=()=>{},this.onExpiry=()=>{},this.loadState()}loadState(){try{const e=localStorage.getItem("countdownState");e?this.applyLoadedState(JSON.parse(e)):this.initializeDefaultState()}catch(e){console.error("Failed to load state from localStorage",e),this.initializeDefaultState()}this.expired=!1,this.holidayService.init(this.holidayCalendar)}applyLoadedState(e){this.targetDate=e.targetDate?new Date(e.targetDate):null,this.holidayCalendar=e.holidayCalendar||this.DEFAULT_HOLIDAY_CALENDAR,this.excludeWeekends=e.excludeWeekends!==!1,this.excludeHolidays=e.excludeHolidays!==!1,this.customExclusions=e.customExclusions||[],this.exclusionIdCounter=this.customExclusions.length>0?Math.max(...this.customExclusions.map(t=>t.id))+1:0}initializeDefaultState(){this.targetDate=null,this.interval=null,this.excludeWeekends=!0,this.excludeHolidays=!0,this.holidayCalendar=this.DEFAULT_HOLIDAY_CALENDAR,this.customExclusions=[],this.exclusionIdCounter=0}saveState(){const e={targetDate:this.targetDate,holidayCalendar:this.holidayCalendar,excludeWeekends:this.excludeWeekends,excludeHolidays:this.excludeHolidays,customExclusions:this.customExclusions};localStorage.setItem("countdownState",JSON.stringify(e))}start(){this.interval&&clearInterval(this.interval),this.update(),this.interval=setInterval(()=>this.update(),1e3)}update(){if(!this.targetDate)return;const e=new Date,t=this.targetDate-e;if(t<=0){this.handleExpired();return}const n=this.calculateBusinessDays(e,this.targetDate),a=Math.floor(t%(1e3*60*60*24)/(1e3*60*60)),i=Math.floor(t%(1e3*60*60)/(1e3*60)),s=Math.floor(t%(1e3*60)/1e3);this.onUpdate({businessDays:n,hours:a,minutes:i,seconds:s,expired:!1})}handleExpired(){this.interval&&(clearInterval(this.interval),this.interval=null),this.expired||(this.expired=!0,this.onExpiry()),this.onUpdate({businessDays:0,hours:0,minutes:0,seconds:0,expired:!0})}setTargetDate(e){this.targetDate=e,this.expired=!1,this.saveState(),this.start()}setHolidayCalendar(e){this.holidayCalendar=e,this.holidayService.init(e),this.saveState(),this.update()}setExcludeWeekends(e){this.excludeWeekends=e,this.saveState(),this.update()}setExcludeHolidays(e){this.excludeHolidays=e,this.saveState(),this.update()}addCustomExclusion(e){this.customExclusions.push(e),this.saveState(),this.update()}removeCustomExclusion(e){this.customExclusions=this.customExclusions.filter(t=>t.id!==e),this.saveState(),this.update()}updateCustomExclusion(e){const t=this.customExclusions.findIndex(n=>n.id===e.id);t!==-1&&(this.customExclusions[t]={...this.customExclusions[t],...e}),this.saveState(),this.update()}getExcludedHolidays(e,t){const n=[],a=e.getFullYear(),i=t.getFullYear();for(let s=a;s<=i;s++){const l=this.holidayService.getHolidays(s).filter(g=>{const r=new Date(g.date);return r>e&&r<t});n.push(...l)}return n.sort((s,o)=>new Date(s.date)-new Date(o.date))}calculateBusinessDays(e,t){let n=0;const a=new Date(e);for(a.setDate(a.getDate()+1),a.setHours(0,0,0,0);a<t;)this.isBusinessDay(a)&&n++,a.setDate(a.getDate()+1);return n}isBusinessDay(e){if(this.excludeWeekends){const t=e.getDay();if(t===0||t===6)return!1}if(this.excludeHolidays){const t=this.holidayService.getHolidays(e.getFullYear()),n=e.toISOString().split("T")[0];if(t.some(a=>a.date.startsWith(n)))return!1}return!this.isDateInCustomExclusions(e)}isDateInCustomExclusions(e){const t=e.toISOString().split("T")[0];return this.customExclusions.some(n=>!n.startDate||!n.endDate?!1:t>=n.startDate&&t<=n.endDate)}}const f=[{code:"en",name:"English"},{code:"es",name:"Español"},{code:"fr",name:"Français"},{code:"de",name:"Deutsch"},{code:"sv",name:"Svenska"}],x=[{id:"usa",name:"USA"},{id:"de",name:"Germany"},{id:"se",name:"Sweden"},{id:"fr",name:"France"},{id:"es",name:"Spain"}],w="/apps/event-countdown/audio/notification.mp3";class C{constructor(e,t,n,a){this.countdown=e,this.holidayService=t,this.localizationService=n,this.notificationService=a,this.initializeElements(),this.populateLanguageSelector(),this.populateHolidayCalendarSelector(),this.bindEvents(),this.initializeState(),this.countdown.onUpdate=i=>this.updateDisplay(i),this.countdown.onExpiry=()=>this.handleExpiry(),this.localizationService.onLanguageChange=()=>this.updateAllText()}initializeElements(){this.elements={targetDate:document.getElementById("targetDate"),holidayCalendar:document.getElementById("holidayCalendar"),language:document.getElementById("language"),excludeWeekends:document.getElementById("excludeWeekends"),excludeHolidays:document.getElementById("excludeHolidays"),businessDays:document.getElementById("businessDays"),hours:document.getElementById("hours"),minutes:document.getElementById("minutes"),seconds:document.getElementById("seconds"),status:document.getElementById("status"),countdownSummary:document.getElementById("countdownSummary"),addExclusion:document.getElementById("addExclusion"),exclusionList:document.getElementById("exclusionList"),exclusionSummary:document.getElementById("exclusionSummary")},this.audio=new Audio(w)}populateLanguageSelector(){this.elements.language.innerHTML="",f.forEach(e=>{const t=document.createElement("option");t.value=e.code,t.textContent=e.name,this.elements.language.appendChild(t)})}populateHolidayCalendarSelector(){this.elements.holidayCalendar.innerHTML="",x.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,this.elements.holidayCalendar.appendChild(t)})}bindEvents(){this.elements.targetDate.addEventListener("change",()=>this.handleTargetDateChange()),this.elements.holidayCalendar.addEventListener("change",()=>this.handleHolidayCalendarChange()),this.elements.language.addEventListener("change",()=>this.handleLanguageChange()),this.elements.excludeWeekends.addEventListener("change",()=>this.handleSettingsChange()),this.elements.excludeHolidays.addEventListener("change",()=>this.handleSettingsChange()),this.elements.addExclusion.addEventListener("click",e=>{e.preventDefault(),this.addCustomExclusion()})}initializeState(){this.notificationService.isSupported()&&this.notificationService.getPermission()==="default"&&this.notificationService.requestPermission(),this.countdown.targetDate?(this.elements.targetDate.value=this.formatDateForInput(this.countdown.targetDate),this.countdown.start()):this.setDefaultDate(),this.elements.holidayCalendar.value=this.countdown.holidayCalendar,this.elements.language.value=this.localizationService.getCurrentLanguage(),this.elements.excludeWeekends.checked=this.countdown.excludeWeekends,this.elements.excludeHolidays.checked=this.countdown.excludeHolidays,this.countdown.customExclusions.forEach(e=>this.renderExclusionItem(e)),this.updateAllText()}setDefaultDate(){const e=new Date;e.setDate(e.getDate()+7),e.setHours(17,0,0,0),this.elements.targetDate.value=this.formatDateForInput(e),this.handleTargetDateChange()}handleTargetDateChange(){if(this.elements.targetDate.value){const e=new Date(this.elements.targetDate.value);this.countdown.setTargetDate(e),this.elements.targetDate.blur()}}async handleHolidayCalendarChange(){const e=this.elements.holidayCalendar.value.toUpperCase();await this.holidayService.init(e),this.handleSettingsChange()}handleLanguageChange(){const e=this.elements.language.value;this.localizationService.loadLanguage(e)}handleSettingsChange(){this.countdown.excludeWeekends=this.elements.excludeWeekends.checked,this.countdown.excludeHolidays=this.elements.excludeHolidays.checked,this.countdown.start()}handleExpiry(){this.audio.play();const e=this.localizationService.translate("timesUp"),t=this.localizationService.translate("alertMessage");this.notificationService.showNotification(e,{body:t}),document.title=e}updateDisplay({businessDays:e,hours:t,minutes:n,seconds:a,expired:i}){this.elements.businessDays.textContent=e.toString(),this.elements.hours.textContent=t.toString().padStart(2,"0"),this.elements.minutes.textContent=n.toString().padStart(2,"0"),this.elements.seconds.textContent=a.toString().padStart(2,"0"),i?(this.elements.countdownSummary.textContent=this.localizationService.translate("timesUp"),this.elements.status.classList.add("expired")):(this.elements.status.classList.remove("expired"),this.updateCountdownSummary()),this.updateExclusionSummary()}updateAllText(){document.querySelector("h1").textContent=this.localizationService.translate("appTitle"),document.querySelector('label[for="targetDate"]').textContent=this.localizationService.translate("targetDateLabel"),document.querySelector('label[for="holidayCalendar"]').textContent=this.localizationService.translate("holidayCalendarLabel"),document.querySelector('label[for="language"]').textContent=this.localizationService.translate("languageLabel"),document.querySelector('label[for="excludeWeekends"]').textContent=this.localizationService.translate("excludeWeekendsLabel"),document.querySelector('label[for="excludeHolidays"]').textContent=this.localizationService.translate("excludeHolidaysLabel"),document.querySelector("#countdown .time-unit:nth-child(1) .time-label").textContent=this.localizationService.translate("businessDaysLabel"),document.querySelector("#countdown .time-unit:nth-child(2) .time-label").textContent=this.localizationService.translate("hoursLabel"),document.querySelector("#countdown .time-unit:nth-child(3) .time-label").textContent=this.localizationService.translate("minutesLabel"),document.querySelector("#countdown .time-unit:nth-child(4) .time-label").textContent=this.localizationService.translate("secondsLabel"),document.querySelector(".custom-exclusions h3").textContent=this.localizationService.translate("customExclusionsTitle"),document.querySelector("#addExclusion").textContent=this.localizationService.translate("addRangeButton"),this.updateCountdownSummary(),this.updateExclusionSummary()}updateCountdownSummary(){if(!this.countdown.targetDate||!this.elements.countdownSummary)return;const e=new Date,t=this.countdown.calculateBusinessDays(e,this.countdown.targetDate),n=Math.ceil((this.countdown.targetDate-e)/(1e3*60*60*24));let a=[this.localizationService.translate("countdownSummary",{businessDays:t,totalDays:n})];if(this.countdown.excludeHolidays){const i=this.countdown.getExcludedHolidays(e,this.countdown.targetDate);if(i.length>0){const s=i.map(o=>`${o.name} (${new Date(o.date).toLocaleDateString(void 0,{month:"short",day:"numeric"})})`).join(", ");a.push(this.localizationService.translate("excludingHolidays",{holidayNames:s}))}}this.elements.countdownSummary.innerHTML=a.join("<br>")}addCustomExclusion(){const t={id:++this.countdown.exclusionIdCounter,startDate:"",endDate:"",description:""};this.countdown.addCustomExclusion(t),this.renderExclusionItem(t)}renderExclusionItem(e){const t=document.createElement("div");t.className="exclusion-item",t.dataset.exclusionId=e.id;const n=this.countdown.targetDate?this.formatDateForInput(this.countdown.targetDate).split("T")[0]:"";t.innerHTML=`
            <input type="date" placeholder="Start Date" data-field="startDate" value="${e.startDate}" data-id="${e.id}" max="${n}" required>
            <input type="date" placeholder="End Date" data-field="endDate" value="${e.endDate}" data-id="${e.id}" max="${n}" required>
            <input type="text" placeholder="Description (optional)" value="${e.description}" data-field="description" data-id="${e.id}" maxlength="50">
            <button class="remove-btn" data-id="${e.id}" title="Remove exclusion">✕</button>
        `,this.elements.exclusionList.appendChild(t),t.querySelector(".remove-btn").addEventListener("click",()=>{this.countdown.removeCustomExclusion(e.id),t.remove(),this.updateExclusionSummary()}),["startDate","endDate","description"].forEach(a=>{t.querySelector(`[data-field="${a}"]`).addEventListener("change",s=>{const o={id:e.id,[a]:s.target.value};if(a==="startDate"){const l=t.querySelector('[data-field="endDate"]');l.value=s.target.value,l.min=s.target.value,o.endDate=s.target.value}this.countdown.updateCustomExclusion(o)})})}updateExclusionSummary(){const e=this.countdown.customExclusions.filter(n=>n.startDate&&n.endDate);let t=this.localizationService.translate("noCustomExclusions");if(e.length>0){const n=e.reduce((a,i)=>{const s=new Date(i.startDate),o=new Date(i.endDate),l=Math.ceil((o-s)/(1e3*60*60*24))+1;return a+Math.max(0,l)},0);t=this.localizationService.translate("exclusionsActive",{count:e.length,totalDays:n})}this.elements.exclusionSummary.textContent=t}formatDateForInput(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0");return`${t}-${n}-${a}T${i}:${s}`}}const L="modulepreload",_=function(d){return"/apps/event-countdown/"+d},p={},c=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){let g=function(r){return Promise.all(r.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};var s=g;document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");a=g(t.map(r=>{if(r=_(r),r in p)return;p[r]=!0;const h=r.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${m}`))return;const u=document.createElement("link");if(u.rel=h?"stylesheet":L,h||(u.as="script"),u.crossOrigin="",u.href=r,l&&u.setAttribute("nonce",l),document.head.appendChild(u),h)return new Promise((D,E)=>{u.addEventListener("load",D),u.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${r}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return a.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},S=(d,e,t)=>{const n=d[e];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((a,i)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(i.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==t?". Note that variables only represent file names one level deep.":""))))})};class I{constructor(e="SE"){this.country=e,this.holidayData={}}async init(e){this.country=e,await this.loadHolidayData(e)}async loadHolidayData(e){if(!this.holidayData[e])try{const t=e.toLowerCase(),n=await S(Object.assign({"./holidays/de.json":()=>c(()=>import("./de-DIVpA5mD.js"),[]),"./holidays/es.json":()=>c(()=>import("./es-Bs8theHA.js"),[]),"./holidays/fr.json":()=>c(()=>import("./fr-BuECurHc.js"),[]),"./holidays/gb.json":()=>c(()=>import("./gb-UW-y7lsm.js"),[]),"./holidays/se.json":()=>c(()=>import("./se--skDM2yJ.js"),[]),"./holidays/us.json":()=>c(()=>import("./us-tgZ1u4Di.js"),[])}),`./holidays/${t}.json`,3);this.holidayData[e]=n}catch(t){console.error(`Failed to load holiday data for ${e}:`,t),this.holidayData[e]={name:"",holidays:{}}}}getHolidays(e){const t=this.holidayData[this.country];return!t||!t.holidays[e]?[]:t.holidays[e].map(n=>({...n,date:n.date+" 00:00:00"}))}}class b{DEFAULT_LANGUAGE="en";constructor(){this.translations={},this.language=this.DEFAULT_LANGUAGE,this.onLanguageChange=()=>{},this.supportedLanguageCodes=f.map(e=>e.code)}getInitialLanguage(){const e="/apps/event-countdown/",t=window.location.pathname,n=e.endsWith("/")?e:`${e}/`;if(t.startsWith(n)){const s=t.substring(n.length).split("/")[0];if(this.supportedLanguageCodes.includes(s))return s}const a=localStorage.getItem("language");if(this.supportedLanguageCodes.includes(a))return a;const i=navigator.language.split("-")[0];return this.supportedLanguageCodes.includes(i)?i:document.documentElement.lang||this.DEFAULT_LANGUAGE}async loadLanguage(e,t=!1){try{if(!this.translations[e]){const n=await S(Object.assign({"./locales/de.json":()=>c(()=>import("./de-DjVwt7sL.js"),[]),"./locales/en.json":()=>c(()=>import("./en-BWWPvHQA.js"),[]),"./locales/es.json":()=>c(()=>import("./es-DqjIsj-o.js"),[]),"./locales/fr.json":()=>c(()=>import("./fr-DUexvFRx.js"),[]),"./locales/sv.json":()=>c(()=>import("./sv-hK1TUiKt.js"),[])}),`./locales/${e}.json`,3);if(!n.default)throw new Error(`No default export found in ${e}.json`);this.translations[e]=n.default}if(this.language=e,localStorage.setItem("language",e),!t){const n="/apps/event-countdown/",a=n.endsWith("/")?n:`${n}/`,i=e===this.DEFAULT_LANGUAGE?a:`${a}${e}/`;history.pushState({lang:e},"",i)}document.documentElement.lang=e,this.onLanguageChange()}catch(n){console.error(`Could not load language file for: ${e}`,n),e!==this.DEFAULT_LANGUAGE&&await this.loadLanguage(this.DEFAULT_LANGUAGE)}}translate(e,t={}){let n=this.translations[this.language][e]||e;for(const a in t)n=n.replace(`{${a}}`,t[a]);return n}getCurrentLanguage(){return this.language}}const y=new b;class A{constructor(){this.permission="default","Notification"in window&&(this.permission=Notification.permission)}isSupported(){return"Notification"in window}getPermission(){return this.permission}async requestPermission(){return this.isSupported()?(this.permission=await Notification.requestPermission(),this.permission):"unsupported"}showNotification(e,t){this.permission==="granted"&&new Notification(e,t)}}document.addEventListener("DOMContentLoaded",async()=>{const d=y.getInitialLanguage();await y.loadLanguage(d,!0);const e=new I;await e.init("US");const t=new A,n=new v(e);new C(n,e,y,t)});
